authorized_users: "{{ (((all_user_attrs | dict2items | selectattr('value.state', 'defined') | rejectattr('value.state', 'eq', 'absent') | list) + (all_user_attrs | dict2items | rejectattr('value.state', 'defined') | list)) | items2dict).keys() }}"

unauthorized_users: "{{ (all_user_attrs | dict2items | selectattr('value.state', 'defined') | selectattr('value.state', 'eq', 'absent') | list | items2dict).keys() }}"
  
all_user_attrs:
  # Existing users
  root:
    admin: yes
    shell: '/bin/zsh'
    password: '$6$e9zHRubiopmvCu4u$3O1FAv04lq8yBeQHaIoFSOK9jTbqtoowcoUfp6liSlbw7c9a001CJu6O.xux4uMnLxrbpk3vORGVg529oU4dI/'
    ssh_keys:
      - 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH6qb4d6mytVq4W4q9X6DHU24g1UygnmF3do1oC5lkmG cb:6c:d4:c6:ab:64:91:4b:6b:e9:02:3e:c4:22:6d:c9 USB-Key BrainStone'
      - 'ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAlyHkM0Hqglp4VWqnIQUm9dl0M68YkErxkNr8CK87Ww6s3ZV8DNDbVaLFK++L+qJc+tSxI+5Y3r2sN6Atht9u4= BrainStone-Mobile'
  
  # Removed users
  debian:
    state: absent
